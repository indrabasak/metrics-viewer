!function(e,t){"function"==typeof define&&define.amd?define(["jquery","MG","d3"],t):"object"==typeof exports?module.exports=t(require("jquery"),require("MG"),require("d3")):e.metricsViewer=t(e.jQuery,e.MG,e.d3)}(this,function(e,t,n){return function(e,l){"use strict";function a(e,n){this.date=t.clone(e),this.value=n}function i(e,t,n,l){this.legend=e,this.key=t,this.metricName=n,this.altMetricName=l}function r(e,a,i,r,u,s,d,o,h,m,c,p){function M(e,t){var n=null;if(e instanceof HTMLElement)n=e.id;else{n=e;var l=e.charAt(0);"#"===l&&(n=e.substring(1))}return n+"."+t}this.divId=e,this.childDiv=a,this.metricType=i,this.metricName=r,this.title=u,this.description=s,this.values=d,this.legendData=o,this.legend=[],this.x_label=h,this.y_label=m,this.y_label_key=c,this.legendDivId=null,this.ignoreMetricName=p,this.initialized=!1;for(var _=0;_<this.legendData.length;_++)this.legend.push(this.legendData[_].legend);this.render=function(){var e=null;if(!this.initialized){if(l(this.divId).is(":empty")){var a=l("<h3>").text(this.title);l(this.divId).append(a);var i=l("<hr>").addClass("mv-title-hr");l(this.divId).append(i),e=M(this.divId,"container");var r=l("<div></div>").attr("id",e).addClass("mv-outer");l(this.divId).append(r),this.divId=document.getElementById(e)}else e=M(this.divId,"container"),this.divId=document.getElementById(e);if(this.childDiv){var u=M(this.divId,this.childDiv),s=l("<div></div>").attr("id",u).addClass("mv-inner");l(s).css("width",f).css("height",y*g),l(this.divId).append(s),this.title=v(this.childDiv);var d=M(u,"chart"),o=l("<div></div>").attr("id",d);l(s).append(o);var h=M(u,"legend"),m=l("<div></div>").attr("id",h).addClass("mv-legend");l(s).append(m),this.legendDivId=document.getElementById(h),this.divId=document.getElementById(d)}this.initialized=!0}l(this.divId).empty(),t.data_graphic({title:this.title,description:this.description,area:!1,data:this.values,width:f,height:y,target:this.divId,x_accessor:"date",y_accessor:"value",x_label:this.x_label,y_label:this.y_label,x_extended_ticks:!0,y_extended_ticks:!0,right:w,left:b,bottom:E,legend:this.legend,legend_target:this.legendDivId,mouseover:function(e,t){var l=n.timeFormat("%b %d, %Y %H:%M:%S %p");n.select(this.divId+" svg .mg-active-datapoint").text(l(e.date))}})},this.refresh=function(e,t){this.x_label=e,this.y_label=t,this.render()}}function u(e,t,n,l,i,u,s,d,o,h,m){for(var v=[],c=0;c<s.length;c++)v[c]=[],v[c].push(new a(new Date,0));return new r(e,t,n,l,i,u,v,s,d,o,h,m)}function s(e,t,n){var l=null,a=e.x_label,i=e.y_label;if(e.ignoreMetricName)for(var r=0;r<e.legendData.length;r++)l=o(n,e.metricType.type,e.legendData[r].metricName,e.legendData[r].altMetricName),d(l,e.legendData[r].key,t,e.values[r]);else{l=o(n,e.metricType.type,e.metricName,null);for(var u=0;u<e.legendData.length;u++)d(l,e.legendData[u].key,t,e.values[u]);if(l&&e.y_label_key)try{i=l[e.y_label_key]}catch(e){}}e.refresh(a,i)}function d(e,t,n,l){var i=0;e&&(i=h(e,t));var r=new a(n,i);for(l.push(r);l.length>p;)l.shift()}function o(e,t,n,l){var a=null;return e[t]&&(a=e[t][n],!a&&l&&(a=e[t][l])),a}function h(e,t){var n=0;try{e[t]&&(n=m(e[t],4))}catch(e){}return n}function m(e,t){t||(t=4);var n=Math.pow(10,t),l=e*n,a=Math.round(l);return a/n}function v(e){return e.charAt(0).toUpperCase()+e.slice(1)}e.addCounter=function(e,t,n,l){var a=[];a.push(new i(l,"count",null,null)),x.push(u(e,"counter",c.COUNTER,l,t,n,a,c.COUNTER.xLabel,c.COUNTER.yLabel,null,!1))},e.addMultiCounter=function(e,t,n,l){if(l.constructor===Array&&l.length){for(var a=[],r=0;r<l.length;r++)a.push(new i(l[r],"count",l[r],null));x.push(u(e,"counter",c.COUNTER,"metricName",t,n,a,c.COUNTER.xLabel,c.COUNTER.yLabel,null,!0))}},e.addGauge=function(e,t,n,l){var a=[];a.push(new i(l,"value",null,null)),x.push(u(e,"gauge",c.GAUGE,l,t,n,a,c.GAUGE.xLabel,c.GAUGE.yLabel,null,!1))},e.addMultiGauge=function(e,t,n,l){if(l.constructor===Array&&l.length){for(var a=[],r=0;r<l.length;r++)a.push(new i(l[r],"value",l[r],null));x.push(u(e,"gauge",c.GAUGE,"metricName",t,n,a,c.GAUGE.xLabel,c.GAUGE.yLabel,null,!0))}},e.addMeter=function(e,t,n,l){var a=[];for(var i in M){var r=M[i];a.push(r)}x.push(u(e,"meter",c.METER,l,t,n,a,c.METER.xLabel,c.METER.yLabel,"units",!1))},e.addMeterWithProperty=function(e,t,n,l,a){var i=M[a];if(i){var r=[];r.push(i),x.push(u(e,"meter",c.METER,l,t,n,r,c.METER.xLabel,c.METER.yLabel,"units",!1))}},e.addTimer=function(e,t,n,l){var a,i,r=[];for(a in _)i=_[a],r.push(i);x.push(u(e,"duration",c.TIMER,l,t,n,r,c.TIMER.xLabel,c.TIMER.yLabel,"duration_units",!1));var s=[];for(a in I)i=I[a],s.push(i);x.push(u(e,"histogram",c.TIMER,l,t,n,s,c.TIMER.xLabel,c.TIMER.yLabel,"duration_units",!1));var d=[];for(a in T)i=T[a],d.push(i);x.push(u(e,"frequency",c.TIMER,l,t,n,d,c.TIMER.xLabel,c.TIMER.yLabel,"rate_units",!1))},e.addTimerWithProperty=function(e,t,n,l,a){var i,r=[];_[a]?(i=_[a],r.push(i),x.push(u(e,"duration",c.TIMER,l,t,n,r,c.TIMER.xLabel,c.TIMER.yLabel,"duration_units",!1))):I[a]?(i=I[a],r.push(i),x.push(u(e,"histogram",c.TIMER,l,t,n,r,c.TIMER.xLabel,c.TIMER.yLabel,"duration_units",!1))):T[a]&&(i=T[a],r.push(i),x.push(u(e,"frequency",c.TIMER,l,t,n,r,c.TIMER.xLabel,c.TIMER.yLabel,"rate_units",!1)))},e.addJvm=function(e,t,n){for(var l=["total","heap"],a=0;a<l.length;a++){var r=[];r.push(new i(v(l[a])+" Init","value","jvm.memory."+l[a]+".init",null)),r.push(new i(v(l[a])+" Used","value","jvm.memory."+l[a]+".used",null)),r.push(new i(v(l[a])+" Max","value","jvm.memory."+l[a]+".max",null)),r.push(new i(v(l[a])+" Committed","value","jvm.memory."+l[a]+".committed",null)),x.push(u(e,l[a],c.GAUGE,"metricName",t,n,r,c.GAUGE.xLabel,"usage",null,!0))}for(var s=["Eden-Space","Survivor-Space","Old-Gen"],d=0;d<s.length;d++){var o=[];o.push(new i(s[d]+" Init","value","jvm.memory.pools.PS-"+s[d]+".init","jvm.memory.pools.Par-"+s[d]+".init")),o.push(new i(s[d]+" Used","value","jvm.memory.pools.PS-"+s[d]+".used","jvm.memory.pools.Par-"+s[d]+".used")),o.push(new i(s[d]+" Max","value","jvm.memory.pools.PS-"+s[d]+".max","jvm.memory.pools.Par-"+s[d]+".max")),o.push(new i(s[d]+" Committed","value","jvm.memory.pools.PS-"+s[d]+"-.committed","jvm.memory.pools.Par-"+s[d]+"-.committed")),x.push(u(e,s[d],c.GAUGE,"metricName",t,n,o,c.GAUGE.xLabel,"usage",null,!0))}var h=[];h.push(new i("Daemon Threads","value","jvm.thread-states.daemon.count",null)),h.push(new i("Deadlocks","value","jvm.thread-states.deadlock.count",null)),h.push(new i("Terminated","value","jvm.thread-states.terminated.count",null)),h.push(new i("Timed Waiting","value","jvm.thread-states.timed_waiting.count",null)),h.push(new i("Blocked","value","jvm.thread-states.blocked.count",null)),h.push(new i("Waiting","value","jvm.thread-states.waiting.count",null)),h.push(new i("Runnable","value","jvm.thread-states.runnable.count",null)),h.push(new i("New","value","jvm.thread-states.new.count",null)),x.push(u(e,"thread",c.GAUGE,"metricName",t,n,h,c.GAUGE.xLabel,"count",null,!0))},e.init=function(){for(var e=0;e<x.length;e++)x[e].render()},e.refresh=function(e){for(var t=new Date,n=0;n<x.length;n++)s(x[n],t,e)},e.clear=function(){for(;x.length;){var e=x.pop();l(e.divId).empty(),delete e.divId,e.values.clear(),delete e.values,e.legendData.clear(),delete e.legendData,e=void 0}},Array.prototype.clear=function(){for(;this.length;)this.pop()};var c={COUNTER:{type:"counters",xLabel:"time",yLabel:"count"},GAUGE:{type:"gauges",xLabel:"time",yLabel:"value"},METER:{type:"meters",xLabel:"time",yLabel:""},TIMER:{type:"timers",xLabel:"time",yLabel:""}};Object.freeze(c);var p=100;Object.freeze(p);var f=650;Object.freeze(f);var y=250;Object.freeze(y);var g=1.2;Object.freeze(g);var b=120;Object.freeze(b);var w=90;Object.freeze(w);var E=50;Object.freeze(E);var M={};M.count=new i("Count","count",null,null),M.m1_rate=new i("1 min","m1_rate",null,null),M.m5_rate=new i("5 min","m5_rate",null,null),M.m15_rate=new i("15 min","m15_rate",null,null),M.mean_rate=new i("Mean","mean_rate",null,null),Object.freeze(M);var _={};_.count=new i("Count","count",null,null),_.min=new i("Min","min",null,null),_.mean=new i("Mean","mean",null,null),_.max=new i("Max","max",null,null),_.stddev=new i("Std. dev","stddev",null,null),_.p50=new i("Median","p50",null,null),Object.freeze(_);var I={};I.p999=new i("99.9%","p999",null,null),I.p99=new i("99%","p99",null,null),I.p98=new i("98%","p98",null,null),I.p95=new i("95%","p95",null,null),I.p75=new i("75%","p75",null,null),Object.freeze(I);var T={};T.m1_rate=new i("1 min","m1_rate",null,null),T.m5_rate=new i("5 min","m5_rate",null,null),T.m15_rate=new i("15 min","m15_rate",null,null),T.mean_rate=new i("Mean","mean_rate",null,null),Object.freeze(T);var x=[]}(window.metricsViewer=window.metricsViewer||{},jQuery),metricsViewer});