!function(e,t){"function"==typeof define&&define.amd?define(["jquery","MG"],t):"object"==typeof exports?module.exports=t(require("jquery"),require("MG")):e.metricsViewer=t(e.jQuery,e.MG)}(this,function(e,t){return function(e,n){"use strict";function l(e,n){this.date=t.clone(e),this.value=n}function a(e,t,n,l){this.legend=e,this.key=t,this.metricName=n,this.altMetricName=l}function i(e,l,a,i,r,u,s,d,h,o,v,c){function E(e,t){var n=null;if(e instanceof HTMLElement)n=e.id;else{n=e;var l=e.charAt(0);"#"===l&&(n=e.substring(1))}return n+"."+t}this.divId=e,this.childDiv=l,this.metricType=a,this.metricName=i,this.title=r,this.description=u,this.values=s,this.legendData=d,this.legend=[],this.x_label=h,this.y_label=o,this.y_label_key=v,this.legendDivId=null,this.ignoreMetricName=c,this.initialized=!1;for(var _=0;_<this.legendData.length;_++)this.legend.push(this.legendData[_].legend);this.render=function(){var e=null;if(!this.initialized){if(n(this.divId).is(":empty")){var l=n("<h3>").text(this.title);n(this.divId).append(l);var a=n("<hr>").addClass("mv-title-hr");n(this.divId).append(a),e=E(this.divId,"container");var i=n("<div></div>").attr("id",e).addClass("mv-outer");n(this.divId).append(i),this.divId=document.getElementById(e)}else e=E(this.divId,"container"),this.divId=document.getElementById(e);if(this.childDiv){var r=E(this.divId,this.childDiv),u=n("<div></div>").attr("id",r).addClass("mv-inner");n(u).css("width",p).css("height",f*y),n(this.divId).append(u),this.title=m(this.childDiv);var s=E(r,"chart"),d=n("<div></div>").attr("id",s);n(u).append(d);var h=E(r,"legend"),o=n("<div></div>").attr("id",h).addClass("mv-legend");n(u).append(o),this.legendDivId=document.getElementById(h),this.divId=document.getElementById(s)}this.initialized=!0}t.data_graphic({title:this.title,description:this.description,animate_on_load:!0,data:this.values,width:p,height:f,target:this.divId,x_accessor:"date",y_accessor:"value",x_label:this.x_label,y_label:this.y_label,x_extended_ticks:!0,y_extended_ticks:!0,right:g,left:b,bottom:w,legend:this.legend,legend_target:this.legendDivId})},this.refresh=function(e,t){this.x_label=e,this.y_label=t,this.render()}}function r(e,t,n,a,r,u,s,d,h,o,m){for(var v=[],c=0;c<s.length;c++)v[c]=[],v[c].push(new l(new Date,0));return new i(e,t,n,a,r,u,v,s,d,h,o,m)}function u(e,t,n){var l=null,a=e.x_label,i=e.y_label;if(e.ignoreMetricName)for(var r=0;r<e.legendData.length;r++)l=d(n,e.metricType.type,e.legendData[r].metricName,e.legendData[r].altMetricName),s(l,e.legendData[r].key,t,e.values[r]);else{l=d(n,e.metricType.type,e.metricName,null);for(var u=0;u<e.legendData.length;u++)s(l,e.legendData[u].key,t,e.values[u]);if(l&&e.y_label_key)try{i=l[e.y_label_key]}catch(e){}}e.refresh(a,i)}function s(e,t,n,a){var i=0;e&&(i=h(e,t));var r=new l(n,i);for(a.push(r);a.length>c;)a.shift()}function d(e,t,n,l){var a=null;return e[t]&&(a=e[t][n],!a&&l&&(a=e[t][l])),a}function h(e,t){var n=0;try{e[t]&&(n=o(e[t],4))}catch(e){}return n}function o(e,t){t||(t=4);var n=Math.pow(10,t),l=e*n,a=Math.round(l);return a/n}function m(e){return e.charAt(0).toUpperCase()+e.slice(1)}e.addCounter=function(e,t,n,l){var i=[];i.push(new a(l,"count",null,null)),T.push(r(e,"counter",v.COUNTER,l,t,n,i,v.COUNTER.xLabel,v.COUNTER.yLabel,null,!1))},e.addMultiCounter=function(e,t,n,l){if(l.constructor===Array&&l.length){for(var i=[],u=0;u<l.length;u++)i.push(new a(l[u],"count",l[u],null));T.push(r(e,"counter",v.COUNTER,"metricName",t,n,i,v.COUNTER.xLabel,v.COUNTER.yLabel,null,!0))}},e.addGauge=function(e,t,n,l){var i=[];i.push(new a(l,"value",null,null)),T.push(r(e,"gauge",v.GAUGE,l,t,n,i,v.GAUGE.xLabel,v.GAUGE.yLabel,null,!1))},e.addMultiGauge=function(e,t,n,l){if(l.constructor===Array&&l.length){for(var i=[],u=0;u<l.length;u++)i.push(new a(l[u],"value",l[u],null));T.push(r(e,"gauge",v.GAUGE,"metricName",t,n,i,v.GAUGE.xLabel,v.GAUGE.yLabel,null,!0))}},e.addMeter=function(e,t,n,l){var a=[];for(var i in E){var u=E[i];a.push(u)}T.push(r(e,"meter",v.METER,l,t,n,a,v.METER.xLabel,v.METER.yLabel,"units",!1))},e.addMeterWithProperty=function(e,t,n,l,a){var i=E[a];if(i){var u=[];u.push(i),T.push(r(e,"meter",v.METER,l,t,n,u,v.METER.xLabel,v.METER.yLabel,"units",!1))}},e.addTimer=function(e,t,n,l){var a,i,u=[];for(a in _)i=_[a],u.push(i);T.push(r(e,"duration",v.TIMER,l,t,n,u,v.TIMER.xLabel,v.TIMER.yLabel,"duration_units",!1));var s=[];for(a in M)i=M[a],s.push(i);T.push(r(e,"histogram",v.TIMER,l,t,n,s,v.TIMER.xLabel,v.TIMER.yLabel,"duration_units",!1));var d=[];for(a in I)i=I[a],d.push(i);T.push(r(e,"frequency",v.TIMER,l,t,n,d,v.TIMER.xLabel,v.TIMER.yLabel,"rate_units",!1))},e.addTimerWithProperty=function(e,t,n,l,a){var i,u=[];_[a]?(i=_[a],u.push(i),T.push(r(e,"duration",v.TIMER,l,t,n,u,v.TIMER.xLabel,v.TIMER.yLabel,"duration_units",!1))):M[a]?(i=M[a],u.push(i),T.push(r(e,"histogram",v.TIMER,l,t,n,u,v.TIMER.xLabel,v.TIMER.yLabel,"duration_units",!1))):I[a]&&(i=I[a],u.push(i),T.push(r(e,"frequency",v.TIMER,l,t,n,u,v.TIMER.xLabel,v.TIMER.yLabel,"rate_units",!1)))},e.addJvm=function(e,t,n){for(var l=["total","heap"],i=0;i<l.length;i++){var u=[];u.push(new a(m(l[i])+" Init","value","jvm.memory."+l[i]+".init",null)),u.push(new a(m(l[i])+" Used","value","jvm.memory."+l[i]+".used",null)),u.push(new a(m(l[i])+" Max","value","jvm.memory."+l[i]+".max",null)),u.push(new a(m(l[i])+" Committed","value","jvm.memory."+l[i]+".committed",null)),T.push(r(e,l[i],v.GAUGE,"metricName",t,n,u,v.GAUGE.xLabel,"usage",null,!0))}for(var s=["Eden-Space","Survivor-Space","Old-Gen"],d=0;d<s.length;d++){var h=[];h.push(new a(s[d]+" Init","value","jvm.memory.pools.PS-"+s[d]+".init","jvm.memory.pools.Par-"+s[d]+".init")),h.push(new a(s[d]+" Used","value","jvm.memory.pools.PS-"+s[d]+".used","jvm.memory.pools.Par-"+s[d]+".used")),h.push(new a(s[d]+" Max","value","jvm.memory.pools.PS-"+s[d]+".max","jvm.memory.pools.Par-"+s[d]+".max")),h.push(new a(s[d]+" Committed","value","jvm.memory.pools.PS-"+s[d]+"-.committed","jvm.memory.pools.Par-"+s[d]+"-.committed")),T.push(r(e,s[d],v.GAUGE,"metricName",t,n,h,v.GAUGE.xLabel,"usage",null,!0))}var o=[];o.push(new a("Daemon Threads","value","jvm.thread-states.daemon.count",null)),o.push(new a("Deadlocks","value","jvm.thread-states.deadlock.count",null)),o.push(new a("Terminated","value","jvm.thread-states.terminated.count",null)),o.push(new a("Timed Waiting","value","jvm.thread-states.timed_waiting.count",null)),o.push(new a("Blocked","value","jvm.thread-states.blocked.count",null)),o.push(new a("Waiting","value","jvm.thread-states.waiting.count",null)),o.push(new a("Runnable","value","jvm.thread-states.runnable.count",null)),o.push(new a("New","value","jvm.thread-states.new.count",null)),T.push(r(e,"thread",v.GAUGE,"metricName",t,n,o,v.GAUGE.xLabel,"count",null,!0))},e.init=function(){for(var e=0;e<T.length;e++)T[e].render()},e.refresh=function(e){for(var t=new Date,n=0;n<T.length;n++)u(T[n],t,e)},e.clear=function(){for(;T.length;){var e=T.pop();n(e.divId).empty()}};var v={COUNTER:{type:"counters",xLabel:"time",yLabel:"count"},GAUGE:{type:"gauges",xLabel:"time",yLabel:"value"},METER:{type:"meters",xLabel:"time",yLabel:""},TIMER:{type:"timers",xLabel:"time",yLabel:""}};Object.freeze(v);var c=100;Object.freeze(c);var p=650;Object.freeze(p);var f=250;Object.freeze(f);var y=1.2;Object.freeze(y);var b=120;Object.freeze(b);var g=90;Object.freeze(g);var w=50;Object.freeze(w);var E={};E.count=new a("Count","count",null,null),E.m1_rate=new a("1 min","m1_rate",null,null),E.m5_rate=new a("5 min","m5_rate",null,null),E.m15_rate=new a("15 min","m15_rate",null,null),E.mean_rate=new a("Mean","mean_rate",null,null),Object.freeze(E);var _={};_.count=new a("Count","count",null,null),_.min=new a("Min","min",null,null),_.mean=new a("Mean","mean",null,null),_.max=new a("Max","max",null,null),_.stddev=new a("Std. dev","stddev",null,null),_.p50=new a("Median","p50",null,null),Object.freeze(_);var M={};M.p999=new a("99.9%","p999",null,null),M.p99=new a("99%","p99",null,null),M.p98=new a("98%","p98",null,null),M.p95=new a("95%","p95",null,null),M.p75=new a("75%","p75",null,null),Object.freeze(M);var I={};I.m1_rate=new a("1 min","m1_rate",null,null),I.m5_rate=new a("5 min","m5_rate",null,null),I.m15_rate=new a("15 min","m15_rate",null,null),I.mean_rate=new a("Mean","mean_rate",null,null),Object.freeze(I);var T=[]}(window.metricsViewer=window.metricsViewer||{},jQuery),metricsViewer});