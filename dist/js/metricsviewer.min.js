!function(e,t){"function"==typeof define&&define.amd?define(["jquery","MG","d3"],t):"object"==typeof exports?module.exports=t(require("jquery"),require("MG"),require("d3")):e.metricsViewer=t(e.jQuery,e.MG,e.d3)}(this,function(e,j,L){return function(e,c){"use strict";e.addCounter=function(e,t,n,l){var a=[];a.push(new M(l,"count",null,null)),v.push(I(e,"counter",h.COUNTER,l,t,n,a,h.COUNTER.xLabel,h.COUNTER.yLabel,null,!1))},e.addMultiCounter=function(e,t,n,l){if(l.constructor===Array&&l.length){for(var a=[],i=0;i<l.length;i++)a.push(new M(l[i],"count",l[i],null));v.push(I(e,"counter",h.COUNTER,"metricName",t,n,a,h.COUNTER.xLabel,h.COUNTER.yLabel,null,!0))}},e.addGauge=function(e,t,n,l){var a=[];a.push(new M(l,"value",null,null)),v.push(I(e,"gauge",h.GAUGE,l,t,n,a,h.GAUGE.xLabel,h.GAUGE.yLabel,null,!1))},e.addMultiGauge=function(e,t,n,l){if(l.constructor===Array&&l.length){for(var a=[],i=0;i<l.length;i++)a.push(new M(l[i],"value",l[i],null));v.push(I(e,"gauge",h.GAUGE,"metricName",t,n,a,h.GAUGE.xLabel,h.GAUGE.yLabel,null,!0))}},e.addMeter=function(e,t,n,l){var a=[];for(var i in u){var r=u[i];a.push(r)}v.push(I(e,"meter",h.METER,l,t,n,a,h.METER.xLabel,h.METER.yLabel,"units",!1))},e.addMeterWithProperty=function(e,t,n,l,a){var i,r=u[a];r&&((i=[]).push(r),v.push(I(e,"meter",h.METER,l,t,n,i,h.METER.xLabel,h.METER.yLabel,"units",!1)))},e.addTimer=function(e,t,n,l){var a,i,r=[];for(a in d)i=d[a],r.push(i);v.push(I(e,"duration",h.TIMER,l,t,n,r,h.TIMER.xLabel,h.TIMER.yLabel,"duration_units",!1));var u=[];for(a in o)i=o[a],u.push(i);v.push(I(e,"histogram",h.TIMER,l,t,n,u,h.TIMER.xLabel,h.TIMER.yLabel,"duration_units",!1));var s=[];for(a in m)i=m[a],s.push(i);v.push(I(e,"frequency",h.TIMER,l,t,n,s,h.TIMER.xLabel,h.TIMER.yLabel,"rate_units",!1))},e.addTimerWithProperty=function(e,t,n,l,a){var i,r=[];d[a]?(i=d[a],r.push(i),v.push(I(e,"duration",h.TIMER,l,t,n,r,h.TIMER.xLabel,h.TIMER.yLabel,"duration_units",!1))):o[a]?(i=o[a],r.push(i),v.push(I(e,"histogram",h.TIMER,l,t,n,r,h.TIMER.xLabel,h.TIMER.yLabel,"duration_units",!1))):m[a]&&(i=m[a],r.push(i),v.push(I(e,"frequency",h.TIMER,l,t,n,r,h.TIMER.xLabel,h.TIMER.yLabel,"rate_units",!1)))},e.addJvm=function(e,t,n){for(var l=["total","heap"],a=0;a<l.length;a++){var i=[];i.push(new M(x(l[a])+" Init","value","jvm.memory."+l[a]+".init",null)),i.push(new M(x(l[a])+" Used","value","jvm.memory."+l[a]+".used",null)),i.push(new M(x(l[a])+" Max","value","jvm.memory."+l[a]+".max",null)),i.push(new M(x(l[a])+" Committed","value","jvm.memory."+l[a]+".committed",null)),v.push(I(e,l[a],h.GAUGE,"metricName",t,n,i,h.GAUGE.xLabel,"usage",null,!0))}for(var r=["Eden-Space","Survivor-Space","Old-Gen"],u=0;u<r.length;u++){var s=[];s.push(new M(r[u]+" Init","value","jvm.memory.pools.PS-"+r[u]+".init","jvm.memory.pools.Par-"+r[u]+".init")),s.push(new M(r[u]+" Used","value","jvm.memory.pools.PS-"+r[u]+".used","jvm.memory.pools.Par-"+r[u]+".used")),s.push(new M(r[u]+" Max","value","jvm.memory.pools.PS-"+r[u]+".max","jvm.memory.pools.Par-"+r[u]+".max")),s.push(new M(r[u]+" Committed","value","jvm.memory.pools.PS-"+r[u]+"-.committed","jvm.memory.pools.Par-"+r[u]+"-.committed")),v.push(I(e,r[u],h.GAUGE,"metricName",t,n,s,h.GAUGE.xLabel,"usage",null,!0))}var d=[];d.push(new M("Daemon Threads","value","jvm.thread-states.daemon.count",null)),d.push(new M("Deadlocks","value","jvm.thread-states.deadlock.count",null)),d.push(new M("Terminated","value","jvm.thread-states.terminated.count",null)),d.push(new M("Timed Waiting","value","jvm.thread-states.timed_waiting.count",null)),d.push(new M("Blocked","value","jvm.thread-states.blocked.count",null)),d.push(new M("Waiting","value","jvm.thread-states.waiting.count",null)),d.push(new M("Runnable","value","jvm.thread-states.runnable.count",null)),d.push(new M("New","value","jvm.thread-states.new.count",null)),v.push(I(e,"thread",h.GAUGE,"metricName",t,n,d,h.GAUGE.xLabel,"count",null,!0))},e.init=function(){for(var e=0;e<v.length;e++)v[e].render()},e.refresh=function(e){for(var t=new Date,n=0;n<v.length;n++)!function(e,t,n){var l=null,a=e.x_label,i=e.y_label;if(e.ignoreMetricName)for(var r=0;r<e.legendData.length;r++)s(l=T(n,e.metricType.type,e.legendData[r].metricName,e.legendData[r].altMetricName),e.legendData[r].key,t,e.values[r]);else{l=T(n,e.metricType.type,e.metricName,null);for(var u=0;u<e.legendData.length;u++)s(l,e.legendData[u].key,t,e.values[u]);if(l&&e.y_label_key)try{i=l[e.y_label_key]}catch(e){}}e.refresh(a,i)}(v[n],t,e)},e.clear=function(){for(;v.length;){var e=v.pop();c(e.divId).empty(),delete e.divId,e.values.clear(),delete e.values,e.legendData.clear(),delete e.legendData,e=void 0}},Array.prototype.clear=function(){for(;this.length;)this.pop()};var h={COUNTER:{type:"counters",xLabel:"time",yLabel:"count"},GAUGE:{type:"gauges",xLabel:"time",yLabel:"value"},METER:{type:"meters",xLabel:"time",yLabel:""},TIMER:{type:"timers",xLabel:"time",yLabel:""}};Object.freeze(h);var r=100;Object.freeze(r);var p=650;Object.freeze(p);var f=250;Object.freeze(f);var y=1.2;Object.freeze(y);var g=120;Object.freeze(g);var b=90;Object.freeze(b);var w=50;Object.freeze(w);var u={};u.count=new M("Count","count",null,null),u.m1_rate=new M("1 min","m1_rate",null,null),u.m5_rate=new M("5 min","m5_rate",null,null),u.m15_rate=new M("15 min","m15_rate",null,null),u.mean_rate=new M("Mean","mean_rate",null,null),Object.freeze(u);var d={};d.count=new M("Count","count",null,null),d.min=new M("Min","min",null,null),d.mean=new M("Mean","mean",null,null),d.max=new M("Max","max",null,null),d.stddev=new M("Std. dev","stddev",null,null),d.p50=new M("Median","p50",null,null),Object.freeze(d);var o={};o.p999=new M("99.9%","p999",null,null),o.p99=new M("99%","p99",null,null),o.p98=new M("98%","p98",null,null),o.p95=new M("95%","p95",null,null),o.p75=new M("75%","p75",null,null),Object.freeze(o);var m={};m.m1_rate=new M("1 min","m1_rate",null,null),m.m5_rate=new M("5 min","m5_rate",null,null),m.m15_rate=new M("15 min","m15_rate",null,null),m.mean_rate=new M("Mean","mean_rate",null,null),Object.freeze(m);var v=[];function E(e,t){this.date=new Date(e.valueOf()),this.value=t}function M(e,t,n,l){this.legend=e,this.key=t,this.metricName=n,this.altMetricName=l}function _(e,t,n,l,a,i,r,u,s,d,h,o){this.divId=e,this.childDiv=t,this.metricType=n,this.metricName=l,this.title=a,this.description=i,this.values=r,this.legendData=u,this.legend=[],this.x_label=s,this.y_label=d,this.y_label_key=h,this.legendDivId=null,this.ignoreMetricName=o,this.initialized=!1;for(var m=0;m<this.legendData.length;m++)this.legend.push(this.legendData[m].legend);function v(e,t){var n=null;return e instanceof HTMLElement?n=e.id:"#"===(n=e).charAt(0)&&(n=e.substring(1)),n+"."+t}this.render=function(){var e,t,n,l,a,i,r,u,s,d=null;this.initialized||(c(this.divId).is(":empty")?(e=c("<h3>").text(this.title),c(this.divId).append(e),t=c("<hr>").addClass("mv-title-hr"),c(this.divId).append(t),d=v(this.divId,"container"),n=c("<div></div>").attr("id",d).addClass("mv-outer"),c(this.divId).append(n)):d=v(this.divId,"container"),this.divId=document.getElementById(d),this.childDiv&&(l=v(this.divId,this.childDiv),a=c("<div></div>").attr("id",l).addClass("mv-inner"),c(a).css("width",p).css("height",f*y),c(this.divId).append(a),this.title=x(this.childDiv),i=v(l,"chart"),r=c("<div></div>").attr("id",i),c(a).append(r),u=v(l,"legend"),s=c("<div></div>").attr("id",u).addClass("mv-legend"),c(a).append(s),this.legendDivId=document.getElementById(u),this.divId=document.getElementById(i)),this.initialized=!0),c(this.divId).empty(),j.data_graphic({title:this.title,description:this.description,area:!1,data:this.values,width:p,height:f,target:this.divId,x_accessor:"date",y_accessor:"value",x_label:this.x_label,y_label:this.y_label,x_extended_ticks:!0,y_extended_ticks:!0,right:b,left:g,bottom:w,legend:this.legend,legend_target:this.legendDivId,mouseover:function(e,t){var n=L.timeFormat("%b %d, %Y %H:%M:%S %p");L.select(this.divId+" svg .mg-active-datapoint").text(n(e.date))}})},this.refresh=function(e,t){this.x_label=e,this.y_label=t,this.render()}}function I(e,t,n,l,a,i,r,u,s,d,h){for(var o=[],m=0;m<r.length;m++)o[m]=[],o[m].push(new E(new Date,0));return new _(e,t,n,l,a,i,o,r,u,s,d,h)}function s(e,t,n,l){var a=0;e&&(a=function(e,t){var n=0;try{e[t]&&(n=function(e,t){t=t||4;var n=Math.pow(10,t),l=e*n;return Math.round(l)/n}(e[t],4))}catch(e){}return n}(e,t));var i=new E(n,a);for(l.push(i);l.length>r;)l.shift()}function T(e,t,n,l){var a=null;return e[t]&&!(a=e[t][n])&&l&&(a=e[t][l]),a}function x(e){return e.charAt(0).toUpperCase()+e.slice(1)}}(window.metricsViewer=window.metricsViewer||{},jQuery),metricsViewer});